angular.module("userApp",["authService","mainCtrl","ngAnimate","app.routes","authService","userService","adminCtrl","chatCtrl","chatService"]).config(["$httpProvider",function(e){e.interceptors.push("AuthInterceptor")}]),angular.module("app.routes",["ngRoute"]).config(["$routeProvider","$locationProvider",function(e,o){e.when("/",{templateUrl:"views/home.html"}).when("/login",{templateUrl:"views/login.html",controller:"mainController",controllerAs:"login"}).when("/admin",{templateUrl:"views/all.html",controller:"adminController",controllerAs:"admin"}).when("/users/create",{templateUrl:"views/single.html",controller:"userCreateController",controllerAs:"user"}).when("/users/:user_id",{templateUrl:"views/single.html",controller:"userEditController",controllerAs:"user"}).when("/users/profile/:user_id",{templateUrl:"views/profile.html",controller:"userProfileController",controllerAs:"user"}).when("/regional",{templateUrl:"views/regional.html",controller:"chatController",controllerAs:"chat"}).otherwise({redirectTo:"/login"}),o.html5Mode(!0)}]),angular.module("adminCtrl",["userService"]).controller("adminController",["User",function(e){var o=this;o.init=function(){e.all().then(function(e){console.log(e),e.data.success&&(o.users=e.data.info),console.log(e.data.message)})},o.init(),o.deleteUser=function(e){o["delete"](e),o.init()},o["delete"]=function(o){e["delete"](o).then(function(e){console.log(e.data.message)})}}]).controller("userCreateController",["User",function(e){var o=this;o.type="create",o.saveUser=function(){o.processing=!0,o.message="",e.create(o.userData).success(function(e){o.processing=!1,o.userData={},o.message=e.message})}}]).controller("userProfileController",["$routeParams","User",function(e,o){var n=this;o.get(e.user_id).success(function(e){n.userData=e})}]).controller("userEditController",["$routeParams","User",function(e,o){var n=this;n.type="edit",o.get(e.user_id).success(function(e){n.userData=e}),n.saveUser=function(){n.processing=!0,n.message="",o.update(e.user_id,n.userData).success(function(e){n.processing=!1,n.userData={},n.message=e.message})}}]),angular.module("chatCtrl",["chatService","rssService"]).controller("chatController",["$scope","socket",function(e,o){o.on("init",function(o){e.name=o.name,e.users=o.users}),o.on("send:message",function(o){e.messages.push(o)}),o.on("change:name",function(e){n(e.oldName,e.newName)}),o.on("load:old:messages",function(o){for(var n=o.length-1;n>=0;n--)e.messages.push({user:o[n].name,text:o[n].msg})}),o.on("user:join",function(o){e.messages.push({user:"",text:"User "+o.name+" has joined."}),e.users.push(o.name)}),o.on("user:left",function(o){e.messages.push({user:"chatroom",text:"User "+o.name+" has left."});var n,r;for(n=0;n<e.users.length;n++)if(r=e.users[n],r===o.name){e.users.splice(n,1);break}});var n=function(o,n){var r;for(r=0;r<e.users.length;r++)e.users[r]===o&&(e.users[r]=n);e.messages.push({user:"chatroom",text:"User "+o+" is now known as "+n+"."})};e.changeName=function(){o.emit("change:name",{name:e.newName},function(o){o?(n(e.name,e.newName),e.name=e.newName,e.newName=""):alert("There was an error changing your name")})},e.messages=[],e.sendMessage=function(){o.emit("send:message",{message:e.message}),e.messages.push({user:e.name,text:e.message}),e.message=""}}]),angular.module("mainCtrl",[]).controller("mainController",["$rootScope","$location","$window","Auth",function(e,o,n,r){var t=this;t.loggedIn=r.isLoggedIn(),e.$on("$routeChangeStart",function(){t.loggedIn=r.isLoggedIn(),t.loggedIn&&n.localStorage.getItem("token")&&r.getUser().success(function(e){e.success&&(t.user=e.info,console.log(JSON.stringify(e.info)),console.log(e.message))}).error(function(e){console.log(e.message)})}),t.doLogin=function(){t.processing=!0,t.error="",r.login(t.loginData.username,t.loginData.password).success(function(e){e.success&&(t.processing=!1,n.localStorage.setItem("token",e.token),o.path("/"),console.log(e.message))}).error(function(e){e.success||(t.error=e.message,console.log(e.message))})},t.doLogout=function(){r.logout(),console.log("Token removed. You have successfully logged out."),t.user="",o.path("/login"),t.loggedIn=!1},t.createSample=function(){r.createSampleUser()}}]),angular.module("authService",[]).factory("Auth",["$http","$q","$window",function(e,o,n){var r={};return r.login=function(o,n){return e.post("/api/authenticate",{username:o,password:n})},r.logout=function(){n.localStorage.removeItem("token")},r.isLoggedIn=function(){return!!n.localStorage.getItem("token")},r.getUser=function(){return e.get("/api/me")},r.createSampleUser=function(){e.post("/api/sample")},r}]).factory("AuthInterceptor",["$q","$location","$window",function(e,o,n){var r={};return r.request=function(e){var o=n.localStorage.getItem("token");return o&&(e.headers["x-access-token"]=o),e},r.responseError=function(r){return 401==r.status&&n.localStorage.removeItem("token"),403==r.status&&(n.localStorage.removeItem("token"),o.path("/login")),e.reject(r)},r}]),angular.module("chatService",[]).factory("socket",["$rootScope",function(e){var o=io.connect();return{on:function(n,r){o.on(n,function(){var n=arguments;e.$apply(function(){r.apply(o,n)})})},emit:function(n,r,t){o.emit(n,r,function(){var n=arguments;e.$apply(function(){t&&t.apply(o,n)})})}}}]),angular.module("rssService",[]).factory("rss",function(){var e=require("ortoo-feedparser"),o="https://news.google.com/news?cf=all&hl=en&pz=1&ned=us&output=rss",n=e.parseUrl(o).on("article",function(e){console.log("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),console.log(e.date),console.log("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~")});return n}),angular.module("userService",[]).factory("User",["$http",function(e){var o={};return o.get=function(o){return e.get("/api/users/"+o)},o.all=function(){return e.get("/api/users/")},o.create=function(o){return e.post("/api/users/",o)},o.update=function(o,n){return e.put("/api/users/"+o,n)},o["delete"]=function(o){return e["delete"]("/api/users/"+o)},o}]);