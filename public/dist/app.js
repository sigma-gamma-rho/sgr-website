angular.module("userApp",["ngAnimate","app.routes","authFactory","interceptFactory","crudFactory","adminService","mainCtrl","adminCtrl","profileCtrl"]).config(["$httpProvider",function(e){e.interceptors.push("AuthInterceptor")}]),angular.module("app.routes",["ngRoute"]).config(["$routeProvider","$locationProvider",function(e,t){e.when("/",{templateUrl:"views/home.html"}).when("/login",{templateUrl:"views/login.html",controller:"mainController",controllerAs:"login"}).when("/error",{templateUrl:"views/error.html"}).when("/admin/users",{templateUrl:"views/all.html",controller:"adminController",controllerAs:"admin",resolve:{message:["adminService",function(e){return e.isAdmin()}]}}).when("/admin/users/create",{templateUrl:"views/profile.html",controller:"profileController",controllerAs:"profile",resolve:{message:["adminService",function(e){return e.isAdmin()}],type:function(){return"create"}}}).when("/admin/users/edit/:user_id",{templateUrl:"views/profile.html",controller:"profileController",controllerAs:"profile",resolve:{message:["adminService",function(e){return e.isAdmin()}],type:function(){return"edit"}}}).when("/admin/users/view/:user_id",{templateUrl:"views/profile.html",controller:"profileController",controllerAs:"profile",resolve:{message:["adminService",function(e){return e.isAdmin()}],type:function(){return"view"}}}).otherwise({redirectTo:"/"}),t.html5Mode(!0)}]),angular.module("adminCtrl",["crudFactory"]).controller("adminController",["Crud","Auth","message",function(e,t,r){console.log("message"+JSON.stringify(r));var o=this;o.init=function(){e.all().then(function(e){e.data.success&&(o.users=e.data.info),console.log(e.data.message)})},o.init(),o["delete"]=function(t){e["delete"](t).then(function(e){console.log(e.data.message),o.init()})}}]),angular.module("mainCtrl",[]).controller("mainController",["$rootScope","$location","$window","Auth",function(e,t,r,o){var n=this;n.loggedIn=o.isLoggedIn(),e.$on("$routeChangeError",function(e,r,o,n){console.log(n),t.path("/error")}),e.$on("$routeChangeStart",function(){n.loggedIn=o.isLoggedIn(),n.loggedIn&&r.localStorage.getItem("token")&&o.getUser().then(function(e){e.data.success&&(n.user=e.data.info,console.log(JSON.stringify(e.data.info))),console.log(e.data.message)})}),n.doLogin=function(){n.error="",o.login(n.loginData.username,n.loginData.password).then(function(e){e.data.success?(r.localStorage.setItem("token",e.data.token),t.path("/")):n.error=e.data.message,console.log(e.data.message)})},n.doLogout=function(){o.logout(),console.log("Token removed. You have successfully logged out."),n.user="",t.path("/login"),n.loggedIn=!1}}]),angular.module("profileCtrl",["crudFactory"]).controller("profileController",["$routeParams","Crud","$location","type",function(e,t,r,o){var n=this;n.init=function(){console.log("Page type is: "+o),"create"===o?n.type="create":"edit"===o?(n.type="edit",n.getUser()):"view"===o&&(n.type="view",n.getUser())},n.getUser=function(){t.get(e.user_id).then(function(e){e.data.success&&(n.userData=e.data.info),console.log(e.data.message)})},n.saveBrother=function(){"create"===o?n.postUser():"edit"===o&&brother.putUser()},n.postUser=function(){n.message="",t.create(n.userData).then(function(e){e.data.success&&(n.userData={}),n.message=e.data.message})},n.putUser=function(){n.message="",t.update(e.user_id,n.userData).then(function(e){e.data.success&&(n.userData={}),n.message=e.data.message})},n.init()}]),angular.module("authFactory",[]).factory("Auth",["$http","$q","$window",function(e,t,r){var o={};return o.login=function(t,r){return e.post("/api/authenticate",{username:t,password:r})},o.logout=function(){r.localStorage.removeItem("token")},o.isLoggedIn=function(){return!!r.localStorage.getItem("token")},o.getUser=function(){return e.get("/api/me")},o}]),angular.module("crudFactory",[]).factory("Crud",["$http",function(e){var t={};return t.get=function(t){return e.get("/api/users/"+t)},t.all=function(){return e.get("/api/users/")},t.create=function(t){return e.post("/api/users/",t)},t.update=function(t,r){return e.put("/api/users/"+t,r)},t["delete"]=function(t){return e["delete"]("/api/users/"+t)},t}]),angular.module("interceptFactory",[]).factory("AuthInterceptor",["$q","$location","$window",function(e,t,r){var o={};return o.request=function(e){var t=r.localStorage.getItem("token");return t&&(e.headers["x-access-token"]=t),e},o.responseError=function(e){return 401==e.status&&(console.log("Interceptor caught 401, redirecting"),r.localStorage.removeItem("token")),403==e.status&&(console.log("Interceptor caught 403, redirecting"),r.localStorage.removeItem("token"),t.path("/login")),e},o}]),angular.module("adminService",["authFactory"]).service("adminService",["$q","$timeout","Auth",function(e,t,r){return{isAdmin:function(){var t=e.defer();return r.getUser().then(function(e){e.data.info.admin?t.resolve({success:!0,message:"200 - OK: Access permitted."}):t.reject({success:!1,message:"403 - Forbidden: Not an admin."})}),t.promise}}}]);